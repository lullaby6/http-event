function httpEventGetElement(t,e){let r;return"this"==e?r=t:"parent"==e?r=t.parentElement:"children"==e?r=t.children:"next"==e?r=t.nextElementSibling:"prev"==e&&(r=t.previousElementSibling),r||(r=t.querySelector(e)),r||(r=t.closest(e)),r||(r=document.querySelector(e)),r}function httpEventLoad(t){t.setAttribute("he-loaded","");let e=t.getAttribute("he-event");"load"==e?httpEventMethod(t,e):t.addEventListener(e,async t=>{t.preventDefault(),httpEventMethod(t.target,e)})}async function httpEventMethod(element,eventName){let url=element.getAttribute("he-url")||window.location.href,method=element.getAttribute("he-method")||"GET",headers={Accept:"application/json","Content-Type":"application/json"},body={};if("submit"==eventName)try{let formData=new FormData(element);body=Object.fromEntries(formData)}catch(error){}if(element.hasAttribute("he-target-form"))try{let form=httpEventGetElement(element,element.getAttribute("he-target-form")),formData=new FormData(form),formDataObj=Object.fromEntries(formData);body={...body,...formDataObj}}catch(error){}if(element.hasAttribute("he-body"))try{body={...body,...JSON.parse(element.getAttribute("he-body"))}}catch(error){}if(element.hasAttribute("he-authentication")&&(headers.Authentication=element.getAttribute("he-authentication")),element.hasAttribute("he-authorization")&&(headers.Authorization=element.getAttribute("he-authorization")),element.hasAttribute("he-headers"))try{headers={...headers,...JSON.parse(element.getAttribute("he-headers"))}}catch(error){}if(element.hasAttribute("he-headers-storage"))try{let storageHeaders=JSON.parse(element.getAttribute("he-headers-storage"));Object.entries(storageHeaders).forEach(([t,e])=>{storageHeaders[t]=localStorage.getItem(e)}),headers={...headers,...storageHeaders}}catch(error){}let options={method,headers};body&&"GET"!=method&&"HEAD"!=method&&(options.body=JSON.stringify(body));try{let response=await fetch(url,options);if(element.hasAttribute("he-status-code")&&response.status!=element.getAttribute("he-status-code")){let dataJson=await response.json();if(dataJson.message)throw Error(dataJson.message);if(dataJson.msg)throw Error(dataJson.msg);if(dataJson.error)throw Error(dataJson.error);throw Error(`${response.status} ${response.statusText}`)}let data=null;if(data=element.hasAttribute("he-json")?await response.json():await response.text(),element.hasAttribute("he-log")&&(console.log("[http-event response]",data),console.log("[http-event headers]",headers),body&&"GET"!=method&&"HEAD"!=method&&console.log("[http-event body]",body)),element.hasAttribute("he-storage")&&localStorage.setItem(element.getAttribute("he-storage"),data),element.hasAttribute("he-json")&&element.hasAttribute("he-storage-json"))try{let storageJson=JSON.parse(element.getAttribute("he-storage-json"));Object.entries(storageJson).forEach(([t,e])=>{localStorage.setItem(t,data[e])})}catch(error){}if(element.hasAttribute("he-attr")){if(element.hasAttribute("he-attr-target")){let target=httpEventGetElement(element,element.getAttribute("he-attr-target"));target.setAttribute(element.getAttribute("he-attr"),data)}else element.setAttribute(element.getAttribute("he-attr"),data)}if(element.hasAttribute("he-run")&&eval(element.getAttribute("he-run")),element.hasAttribute("he-clear-inputs")){let inputs=element.querySelectorAll("input");inputs.forEach(t=>t.value="")}if(element.hasAttribute("he-success-target")){let successElement=httpEventGetElement(element,element.getAttribute("he-success-target"));if(successElement){let text=element.getAttribute("he-success-text")||null;if(!text){if("object"==typeof data)text=data.message?data.message:data.msg?data.msg:data;else try{let dataJson=JSON.parse(data);text=dataJson.message?dataJson.message:dataJson.msg?dataJson.msg:data}catch(error){text=data}}text&&(successElement.innerText=text)}}element.hasAttribute("he-redirect")&&(window.location.href=element.getAttribute("he-redirect")),element.hasAttribute("he-open")&&window.open(element.getAttribute("he-open"),"_blank")}catch(error){if(element.hasAttribute("he-log")&&(console.error("[http-event error]",error),console.error("[http-event headers]",headers),body&&"GET"!=method&&"HEAD"!=method&&console.error("[http-event body]",body)),element.hasAttribute("he-error-target")){let errorElement=httpEventGetElement(element,element.getAttribute("he-error-target"));if(errorElement){let text=element.getAttribute("he-error-text")||error.message;errorElement.innerText=text}}}}function httpEvent(){let t=document.querySelectorAll("[he-event]:not([he-loaded])");t.forEach(httpEventLoad)}document.addEventListener("DOMContentLoaded",()=>{httpEvent(),window.httpEventMutationObserver=new MutationObserver(httpEvent),window.httpEventMutationObserver.observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0})});