function httpEventGetElement(t,e){let r;return"this"==e?r=t:"parent"==e?r=t.parentElement:"children"==e?r=t.children:"next"==e?r=t.nextElementSibling:"prev"==e&&(r=t.previousElementSibling),r||(r=t.querySelector(e)),r||(r=t.closest(e)),r||(r=document.querySelector(e)),r}function httpEventLoad(t){t.setAttribute("he-loaded","");let e=t.getAttribute("he-event");"load"==e?httpEventMethod(t,e):t.addEventListener(e,async t=>{t.preventDefault(),httpEventMethod(t.target,e)})}async function httpEventMethod(element,eventName){let url=element.getAttribute("he-url")||window.location.href,method=element.getAttribute("he-method")||"GET",headers={Accept:"application/json","Content-Type":"application/json"},body={};if(element.hasAttribute("he-body"))try{body={...body,...JSON.parse(element.getAttribute("he-body"))}}catch(error){}if(element.hasAttribute("he-body-storage"))try{let bodyStorage=JSON.parse(element.getAttribute("he-body-storage"));Object.entries(bodyStorage).forEach(([t,e])=>{null!=localStorage.getItem(e)?bodyStorage[t]=localStorage.getItem(e):delete bodyStorage[t]}),body={...body,...bodyStorage}}catch(error){}if(element.hasAttribute("he-body-attr"))try{let bodyAttrs=JSON.parse(element.getAttribute("he-body-storage"));Object.entries(bodyAttrs).forEach(([t,e])=>{element.hasAttribute(e)?bodyAttrs[t]=element.getAttribute(e):delete bodyAttrs[t]}),body={...body,...bodyAttrs}}catch(error){}if("submit"==eventName)try{let formData=new FormData(element),formDataObj=Object.fromEntries(formData);body={...body,...formDataObj}}catch(error){}if(element.hasAttribute("he-target-form"))try{let form=httpEventGetElement(element,element.getAttribute("he-target-form")),formData=new FormData(form),formDataObj=Object.fromEntries(formData);body={...body,...formDataObj}}catch(error){}if(element.hasAttribute("he-headers"))try{headers={...headers,...JSON.parse(element.getAttribute("he-headers"))}}catch(error){}if(element.hasAttribute("he-headers-storage"))try{let headersStorage=JSON.parse(element.getAttribute("he-headers-storage"));Object.entries(headersStorage).forEach(([t,e])=>{null!=localStorage.getItem(e)?headersStorage[t]=localStorage.getItem(e):delete headersStorage[t]}),headers={...headers,...headersStorage}}catch(error){}if(element.hasAttribute("he-headers-attr"))try{let headersAttrs=JSON.parse(element.getAttribute("he-headers-attr"));Object.entries(headersAttrs).forEach(([t,e])=>{element.hasAttribute(e)?headersAttrs[t]=element.getAttribute(e):delete headersAttrs[t],headers={...headers,...headersAttrs}})}catch(error){}element.hasAttribute("he-accept")&&(headers.Accept=element.getAttribute("he-accept")),element.hasAttribute("he-encoding")&&(headers["Accept-Encoding"]=element.getAttribute("he-encoding")),element.hasAttribute("he-content-type")&&(headers["Content-Type"]=element.getAttribute("he-content-type")),(element.hasAttribute("he-form-data")||"multipart/form-data"==headers["Content-Type"])&&(headers["Content-Type"]="multipart/form-data",body&&Object.keys(body).length>0&&Object.entries(body=new FormData).forEach(([t,e])=>formData.append(t,e))),(element.hasAttribute("he-form-urlencoded")||"application/x-www-form-urlencoded"==headers["Content-Type"])&&(headers["Content-Type"]="application/x-www-form-urlencoded",body&&Object.keys(body).length>0&&(body=new URLSearchParams(Object.entries(body)).toString())),element.hasAttribute("he-authentication")&&(headers.Authentication=element.getAttribute("he-authentication")),element.hasAttribute("he-authorization")&&(headers.Authorization=element.getAttribute("he-authorization"));let options={method,headers};body&&Object.keys(body).length>0&&"GET"!=method&&"HEAD"!=method&&(options.body=JSON.stringify(body));try{let response=await fetch(url,options);if(element.hasAttribute("he-status-code")&&response.status!=element.getAttribute("he-status-code")){let dataJson=await response.json();if(dataJson.message)throw Error(dataJson.message);if(dataJson.msg)throw Error(dataJson.msg);if(dataJson.error)throw Error(dataJson.error);throw Error(`Expected status code ${element.getAttribute("he-status-code")}, got ${response.status} - ${response.statusText}`)}let data=null;if(element.hasAttribute("he-json"))try{data=await response.json()}catch(error){throw Error("Error on parsing the response data into json")}else if(element.hasAttribute("he-safe-json"))try{data=await response.json()}catch(error){}else data=await response.text();if(element.hasAttribute("he-log")&&(console.log("[http-event response]",response),console.log("[http-event response data]",data),console.log("[http-event headers]",headers),body&&"GET"!=method&&"HEAD"!=method&&console.log("[http-event body]",body)),element.hasAttribute("he-storage")&&localStorage.setItem(element.getAttribute("he-storage"),data),element.hasAttribute("he-json")&&element.hasAttribute("he-storage-json"))try{let storageJson=JSON.parse(element.getAttribute("he-storage-json"));Object.entries(storageJson).forEach(([t,e])=>{localStorage.setItem(t,data[e])})}catch(error){throw Error("Error on parsing the response data into json to store in local storage")}if(element.hasAttribute("he-attr")){if(element.hasAttribute("he-attr-target")){let target=httpEventGetElement(element,element.getAttribute("he-attr-target"));target.setAttribute(element.getAttribute("he-attr"),data)}else element.setAttribute(element.getAttribute("he-attr"),data)}if(element.hasAttribute("he-attr-json"))try{let attrJson=JSON.parse(element.getAttribute("he-attr-json"));Object.entries(attrJson).forEach(([t,e])=>{element.setAttribute(t,data[e])})}catch(error){}if(element.hasAttribute("he-run")&&eval(element.getAttribute("he-run")),element.hasAttribute("he-clear-inputs")){let inputs=element.querySelectorAll("input");inputs.forEach(t=>t.value="")}if(element.hasAttribute("he-success-target")){let successElement=httpEventGetElement(element,element.getAttribute("he-success-target"));if(successElement){let text=element.getAttribute("he-success-text")||null;if(!text){if("object"==typeof data)text=data.message?data.message:data.msg?data.msg:data;else try{let dataJson=JSON.parse(data);text=dataJson.message?dataJson.message:dataJson.msg?dataJson.msg:data}catch(error){text=data}}text&&(successElement.innerText=text)}}element.hasAttribute("he-redirect")&&(window.location.href=element.getAttribute("he-redirect")),element.hasAttribute("he-open")&&window.open(element.getAttribute("he-open"),"_blank"),element.hasAttribute("he-success-event")&&element.dispatchEvent(new Event(element.getAttribute("he-success-event"))),element.hasAttribute("he-window-success-event")&&window.dispatchEvent(new Event(element.getAttribute("he-window-success-event")))}catch(error){if(element.hasAttribute("he-log")&&(console.error("[http-event error]",error),console.error("[http-event headers]",headers),body&&"GET"!=method&&"HEAD"!=method&&console.error("[http-event body]",body)),element.hasAttribute("he-error-target")){let errorElement=httpEventGetElement(element,element.getAttribute("he-error-target"));if(errorElement){let text=element.getAttribute("he-error-text")||error.message;errorElement.innerText=text}}element.hasAttribute("he-error-event")&&element.dispatchEvent(new Event(element.getAttribute("he-error-event"))),element.hasAttribute("he-window-error-event")&&window.dispatchEvent(new Event(element.getAttribute("he-window-error-event")))}element.hasAttribute("he-run-event")&&element.dispatchEvent(new Event(element.getAttribute("he-run-event"))),element.hasAttribute("he-window-event")&&window.dispatchEvent(new Event(element.getAttribute("he-window-event")))}function httpEvent(){let t=document.querySelectorAll("[he-event]:not([he-loaded])");t.forEach(httpEventLoad)}document.addEventListener("DOMContentLoaded",()=>{httpEvent(),window.httpEventMutationObserver=new MutationObserver(httpEvent),window.httpEventMutationObserver.observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0})});