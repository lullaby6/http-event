function httpEventGetElement(t,e){let r;return"this"==e?r=t:"parent"==e?r=t.parentElement:"children"==e?r=t.children:"next"==e?r=t.nextElementSibling:"previous"==e&&(r=t.previousElementSibling),r||(r=t.querySelector(e)),r||(r=t.closest(e)),r||(r=document.querySelector(e)),r}function httpEvent(){let t=document.querySelectorAll("[he-event]");t.forEach(t=>{if(t.httpEventLoaded)return;t.httpEventLoaded=!0;let e=t.getAttribute("he-event");"load"==e?httpEventMethod(t,e):t.addEventListener(e,async t=>{t.preventDefault(),httpEventMethod(t.target,e)})})}async function httpEventMethod(targetElement,eventName){let httpData={};"submit"==eventName&&(httpData=Object.fromEntries(new FormData(targetElement))),targetElement.hasAttribute("he-data")&&(httpData={...httpData,...JSON.parse(targetElement.getAttribute("he-data"))});let url=targetElement.getAttribute("he-url")||window.location.href,method=targetElement.getAttribute("he-method")||"GET",headers={Accept:"application/json","Content-Type":"application/json"};targetElement.hasAttribute("he-authentication")&&(headers.Authentication=targetElement.getAttribute("he-authentication")),targetElement.hasAttribute("he-authorization")&&(headers.Authorization=targetElement.getAttribute("he-authorization")),targetElement.hasAttribute("he-headers")&&(headers={...headers,...JSON.parse(targetElement.getAttribute("he-headers"))}),targetElement.hasAttribute("he-headers-storage")&&(Object.entries(storageHeaders=JSON.parse(targetElement.getAttribute("he-headers-storage"))).forEach(([t,e])=>storageHeaders[t]=localStorage.getItem(e)),headers={...headers,...storageHeaders});try{let response=await fetch(url,{method,headers,body:JSON.stringify(httpData)});if(targetElement.hasAttribute("he-status-code")&&response.status!=targetElement.getAttribute("he-status-code")){let responseJson=await response.json();if(responseJson.message)throw Error(responseJson.message);if(responseJson.msg)throw Error(responseJson.msg);if(responseJson.error)throw Error(responseJson.error);throw Error(`${response.status} ${response.statusText}`)}let responseData=null;if(responseData=targetElement.hasAttribute("he-json")?await response.json():await response.text(),targetElement.hasAttribute("he-log")&&(console.log("[http-event response]",responseData),console.log("[http-event headers]",headers),console.log("[http-event body]",httpData)),targetElement.hasAttribute("he-storage")&&localStorage.setItem(targetElement.getAttribute("he-storage"),responseData),targetElement.hasAttribute("he-run")&&eval(targetElement.getAttribute("he-run")),targetElement.hasAttribute("he-clear-inputs")){let inputs=targetElement.querySelectorAll("input");inputs.forEach(t=>t.value="")}if(targetElement.hasAttribute("he-success-target")){let successElement=httpEventGetElement(targetElement,targetElement.getAttribute("he-success-target"));if(successElement){let text=targetElement.getAttribute("he-success-text")||null;if(!text){if("object"==typeof responseData)text=responseData.message?responseData.message:responseData.msg?responseData.msg:responseData;else try{let responseJson=JSON.parse(responseData);text=responseJson.message?responseJson.message:responseJson.msg?responseJson.msg:responseData}catch(error){text=responseData}}text&&(successElement.innerText=text)}}targetElement.hasAttribute("he-redirect")&&(window.location.href=targetElement.getAttribute("he-redirect"))}catch(error){if(targetElement.hasAttribute("he-log")&&(console.error(`[http-event error] ${error}`),console.error("[http-event headers]",headers),console.error("[http-event body]",httpData)),targetElement.hasAttribute("he-error-target")){let errorElement=httpEventGetElement(targetElement,targetElement.getAttribute("he-error-target"));if(errorElement){let text=targetElement.getAttribute("he-error-text")||error.message;errorElement.innerText=text}}}}document.addEventListener("DOMContentLoaded",()=>{httpEvent()});